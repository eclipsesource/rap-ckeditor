<html>
<head>
	<script type="text/javascript" src="/resources/ckeditor.js"></script>
	<script type="text/javascript">

	  if( typeof JSON === "undefined" ) {
	    JSON = {};
	    JSON.stringify = function (obj) {  
        var t = typeof (obj);  
        if (t != "object" || obj === null) {  
          // simple data type  
          if (t == "string") obj = '"'+obj+'"';  
            return String(obj);  
          } else {  
            // recurse array or object  
            var n, v, json = [], arr = (obj && obj.constructor == Array);  
            for (n in obj) {  
              v = obj[n]; t = typeof(v);  
              if (t == "string") v = '"'+v+'"';  
                else if (t == "object" && v !== null) v = JSON.stringify(v);  
              json.push((arr ? "" : '"' + n + '":') + String(v));  
            }  
          return (arr ? "[" : "{") + String(json) + (arr ? "]" : "}");  
          }  
        };    
      }

      rap = {};
      rap.init = false;
      rap.styles = [];

      rap.getActiveStyles = function() {
        var result = [];
        var path = new CKEDITOR.dom.elementPath( rap.editor.getSelection().getStartElement() );
        for( var i = 0; i < this.styles.length; i++ ) {
          if( this.styles[ i ].checkActive( path ) ) {
            result.push( i );
          }
        }
        return JSON.stringify( result );
      }

      rap.update = function( field ) {
        console.log( field );
      };

      rap.createEditor = function() {
        rap.editor = CKEDITOR.appendTo( document.body );
        rap.editor.on( "uiReady", function() {
          rap.editor.getThemeSpace( "top" ).hide();
        } );
        rap.editor.on( "dataReady", function() {
          if( !rap.init ) {
            rap.init = true;
            // NOTE [tb] : does not work in uiReady for some reason:
            rap.editor.execCommand( "maximize" ); 
          }
          try {
            rap_ready();
          } catch( ex ) {
            alert( "CKEditor ready error:  " + ex );
          }
        } );
        rap.editor.on( "selectionChange", function() {
          rap.update( "activeStyles" );
        } );        
        rap.editor.on( "key", function() {
          rap.update( "key" );
        } );        
      }
	</script>
</head>
<body>
</body>
</html>
